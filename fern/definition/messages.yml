# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  inboxes: inboxes.yml

types:
  MessageId:
    type: string
    docs: ID of message.

  Attachment:
    properties:
      id: string
      name: string
      type: string
      size: integer

  MessageItem:
    properties:
      id: MessageId
      sent_at: datetime
      from: string
      subject: string
      preview: string
      to: optional<list<string>>
      cc: optional<list<string>>
      bcc: optional<list<string>>
      attachments: optional<list<Attachment>>

  Message:
    properties:
      id: MessageId
      thread_id: string
      sent_at: datetime
      recieved_at: datetime
      from: string
      subject: string
      preview: string
      to: optional<list<string>>
      cc: optional<list<string>>
      bcc: optional<list<string>>
      text: optional<string>
      html: optional<string>
      in_reply_to: optional<string>
      references: optional<list<string>>
      attachments: optional<list<Attachment>>

  ListMessagesResponse:
    properties:
      messages: list<MessageItem>
      limit: integer
      count: integer
      last_key: optional<string>

  Addresses:
    discriminated: false
    union:
      - string
      - list<string>

  SendMessageRequest:
    properties:
      to:
        type: Addresses
        docs: Recipient address or addresses.
      cc:
        type: optional<Addresses>
        docs: CC recipient address or addresses.
      bcc:
        type: optional<Addresses>
        docs: BCC recipient address or addresses.
      subject:
        type: optional<string>
        docs: Subject of message.
      text:
        type: optional<string>
        docs: Plain text body of message.
      html:
        type: optional<string>
        docs: HTML body of message.

  SendMessageResponse:
    properties:
      thread_id:
        type: string
        docs: Thread ID of message.
      message_id: MessageId

  ReplyToMessageRequest:
    properties:
      to: optional<list<string>>
      cc: optional<list<string>>
      bcc: optional<list<string>>
      text: optional<string>
      html: optional<string>

errors:
  MessageDoesNotExistError:
    status-code: 404
    type: string

service:
  base-path: /inboxes/{inbox_id}/messages
  path-parameters:
    inbox_id: inboxes.InboxId

  auth: true

  endpoints:
    listMessages:
      docs: Ordered by `sent_at` descending.
      method: GET
      path: /
      request:
        name: ListMessagesRequest
        query-parameters:
          limit: optional<integer>
          last_key: optional<string>
      response: ListMessagesResponse
      errors:
        - inboxes.InboxDoesNotExistError

    getMessage:
      method: GET
      path: /{message_id}
      path-parameters:
        message_id: MessageId
      response: Message
      errors:
        - inboxes.InboxDoesNotExistError
        - MessageDoesNotExistError

    deleteMessage:
      method: DELETE
      path: /{message_id}
      path-parameters:
        message_id: MessageId
      errors:
        - inboxes.InboxDoesNotExistError
        - MessageDoesNotExistError

    sendMessage:
      method: POST
      path: /send
      docs: Send message from inbox.
      request: SendMessageRequest
      response: SendMessageResponse
      errors:
        - inboxes.InboxDoesNotExistError

    replyToMessage:
      method: POST
      path: /{message_id}/reply
      path-parameters:
        message_id: MessageId
      request: ReplyToMessageRequest
      response: SendMessageResponse
      errors:
        - inboxes.InboxDoesNotExistError
        - MessageDoesNotExistError
